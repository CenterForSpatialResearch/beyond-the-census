extends layout

block content
  #map

  script(type='text/javascript').
    !(function(){
        "use strict";
        
        var map;
        
        d3.json("data/japan.geojson",main);
        
        
        function main(data) {
            addLmaps();
            drawFeatures(data);   
        }
        
        function addLmaps() {
          
            map = L.map('map').setView([39.702053ã€€, 141.15448379999998], 5);
            
            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
        
           
            L.svg().addTo(map);	
            
        }
        
      
        function projectPoint(x, y) {
            var point = map.latLngToLayerPoint(new L.LatLng(y, x));
            this.stream.point(point.x, point.y);
        }
        
        function drawFeatures(data) {
            var svg = d3.select("#map").select("svg");
            
            var transform = d3.geoTransform({point: projectPoint});
            var path = d3.geoPath().projection(transform);
        
            var featureElement = svg.selectAll("path")
                .data(data.features)
                .enter()
                .append("path")
                .attr("stroke", "gray")
                .attr("fill", "green")
                .attr("fill-opacity", 0.6);
        
            map.on("moveend", update);
        
            update();
        

            function update() {		
                featureElement.attr("d", path);
            } 
        
        }
        
            
    }());
